// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String          @id @default(uuid())
  clerk_id       String          @unique
  email          String          @unique
  name           String?
  created_at     DateTime        @default(now())
  subscriptions  Subscription[]
}

model App {
  id          String   @id @default(cuid())
  slug        String   @unique  // "ent", "finaly"
  name        String            // "ENT"
  tagline     String            // "Reportes y gestión sin límites"
  description String            // Descripción larga para el hero
  badge       String            // "Suite Empresarial"
  heroAccent  String            // La palabra que va en lime en el H1
  isActive    Boolean  @default(true)
  comingSoon  Boolean  @default(false)
  iconName    String            // nombre del ícono lucide: "Building2"
  tags        String[]          // ["Reportes", "Dashboard", "Multi-usuario"]
  stats       Json              // [{label: "Reportes/mes", value: "500+"}, ...]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  features    AppFeature[]
  plans       AppPlan[]
  faqs        AppFAQ[]
  subscriptions Subscription[]
}

model AppFeature {
  id          String  @id @default(cuid())
  appId       String
  app         App     @relation(fields: [appId], references: [id])
  iconName    String  // "BarChart3"
  title       String  // "Reportes personalizados"
  description String  // "Genera reportes a medida..."
  order       Int     @default(0)
}

model AppPlan {
  id           String   @id @default(cuid())
  appId        String
  app          App      @relation(fields: [appId], references: [id])
  name         String   // "Starter", "Team", "Business", "Enterprise"
  userRange    String   // "1 – 4 usuarios", "Sin límite"
  price        Decimal  // 29.00
  description  String   // "Perfecto para equipos pequeños"
  isHighlighted Boolean @default(false)  // true solo para el plan destacado
  paypalPlanId String?  // ID del plan en PayPal (se llena en Día 5)
  features     Json     // [{text: "Reportes ilimitados", included: true}, ...]
  order        Int      @default(0)
}

model AppFAQ {
  id       String @id @default(cuid())
  appId    String
  app      App    @relation(fields: [appId], references: [id])
  question String
  answer   String
  order    Int    @default(0)
}

model Subscription {
  id                    String           @id @default(uuid())
  user_id               String
  app_id                String
  status                String // 'active', 'cancelled', 'expired', 'pending'
  plan                  String // 'basic', 'premium', 'enterprise'
  paypal_subscription_id String?          @unique
  started_at            DateTime         @default(now())
  current_period_end    DateTime?
  cancelled_at          DateTime?
  created_at            DateTime         @default(now())
  updated_at            DateTime         @updatedAt
  user                  User             @relation(fields: [user_id], references: [id])
  app                   App              @relation(fields: [app_id], references: [id])
  payments              PaymentHistory[]
}

model PaymentHistory {
  id                    String       @id @default(uuid())
  subscription_id       String
  amount                Decimal      @db.Decimal(10, 2)
  currency              String       @default("USD")
  status                String
  paypal_transaction_id String?
  paid_at               DateTime?
  created_at            DateTime     @default(now())
  subscription          Subscription @relation(fields: [subscription_id], references: [id])
}

