// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String          @id @default(uuid())
  clerk_id       String          @unique
  email          String          @unique
  name           String?
  created_at     DateTime        @default(now())
  subscriptions  Subscription[]
}

model App {
  id             String          @id
  name           String
  description    String?
  url            String?
  is_active      Boolean         @default(true)
  status         String          @default("draft") // 'draft' | 'published' — controla si la página está publicada
  subscriptions  Subscription[]
}

model Subscription {
  id                    String           @id @default(uuid())
  user_id               String
  app_id                String
  status                String // 'active', 'cancelled', 'expired', 'pending'
  plan                  String // 'basic', 'premium', 'enterprise'
  paypal_subscription_id String?          @unique
  started_at            DateTime         @default(now())
  current_period_end    DateTime?
  cancelled_at          DateTime?
  created_at            DateTime         @default(now())
  updated_at            DateTime         @updatedAt
  user                  User             @relation(fields: [user_id], references: [id])
  app                   App              @relation(fields: [app_id], references: [id])
  payments              PaymentHistory[]
}

model PaymentHistory {
  id                    String       @id @default(uuid())
  subscription_id       String
  amount                Decimal      @db.Decimal(10, 2)
  currency              String       @default("USD")
  status                String
  paypal_transaction_id String?
  paid_at               DateTime?
  created_at            DateTime     @default(now())
  subscription          Subscription @relation(fields: [subscription_id], references: [id])
}
